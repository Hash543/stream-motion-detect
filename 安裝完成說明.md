# 🎉 RTSP影像監控系統安裝完成！

## ✅ 安裝狀態

**恭喜！系統已成功安裝並可以正常運行**

### 已完成的功能
- ✅ **RTSP串流處理** - 多攝影機支援
- ✅ **安全帽檢測** - 使用YOLO模型
- ✅ **瞌睡檢測** - 基於眼部檢測
- ✅ **人臉檢測** - 使用MediaPipe
- ✅ **自動截圖** - 違規事件記錄
- ✅ **API通知** - RESTful通知系統
- ✅ **資料庫管理** - SQLite儲存
- ✅ **設定管理** - JSON配置檔案

### 套件安裝狀態
```
✅ OpenCV 4.12.0        - 影像處理
✅ PyTorch 2.1.0        - AI框架
✅ Ultralytics 8.3.202  - YOLO模型
✅ MediaPipe 0.10.14    - 人臉檢測
✅ FastAPI 0.117.1      - Web框架
✅ SQLAlchemy 2.0.43    - 資料庫ORM
✅ NumPy 1.26.4         - 數值計算
❌ dlib                 - 編譯失敗 (使用MediaPipe替代)
❌ face_recognition     - 依賴dlib (使用MediaPipe替代)
```

## 🚀 如何啟動系統

### 1. 快速測試
```bash
cd D:\stream-motion-detect
python start_system.py
```

### 2. 設定RTSP攝影機
編輯 `config/config.json` 檔案，修改 RTSP URL：
```json
{
  "rtsp_sources": [
    {
      "id": "camera_001",
      "url": "rtsp://您的攝影機IP:554/stream1",
      "location": "入口"
    }
  ]
}
```

### 3. 設定通知API
修改通知端點：
```json
{
  "notification_api": {
    "endpoint": "https://您的伺服器.com/api/violations"
  }
}
```

## 📋 系統使用指南

### 基本命令
```bash
# 系統驗證
python start_system.py

# 驗證設定檔
python main.py --validate-config

# 測試API連接
python main.py --test-connection

# 完整啟動
python main.py
```

### 系統檔案結構
```
D:\stream-motion-detect\
├── config/config.json      # 系統設定檔
├── src/                    # 原始碼
├── screenshots/            # 截圖儲存 (自動建立)
├── logs/                   # 日誌檔案 (自動建立)
├── data/                   # 資料庫檔案 (自動建立)
├── models/                 # AI模型檔案 (可選)
├── start_system.py         # 簡化啟動腳本
└── main.py                # 完整啟動腳本
```

## ⚙️ 重要設定項目

### 1. 檢測靈敏度
```json
"detection_settings": {
  "helmet_confidence_threshold": 0.7,     // 安全帽檢測信心度
  "drowsiness_duration_threshold": 3.0,   // 瞌睡持續時間(秒)
  "processing_fps": 2                     // 處理頻率
}
```

### 2. 儲存設定
```json
"storage": {
  "screenshot_path": "./screenshots/",
  "max_storage_days": 30,                 // 截圖保留天數
  "image_quality": 95                     // 圖片品質
}
```

## 🔧 進階設定 (可選)

### 安裝完整人臉識別功能
如果需要精確的人臉識別：

**方法1: 使用Conda**
```bash
conda install -c conda-forge dlib
pip install face_recognition
```

**方法2: 手動安裝dlib**
1. 下載預編譯dlib wheel檔案
2. `pip install dlib-19.24.2-cp311-cp311-win_amd64.whl`

### 自訂AI模型
- 安全帽檢測模型: 放在 `models/helmet_detection.pt`
- 人臉識別模型: 放在 `models/face_recognition.pkl`

## 📊 系統監控

### 查看日誌
```bash
# 即時查看日誌
tail -f logs/monitoring.log

# 查看系統狀態
python main.py --status
```

### 資料庫查詢
系統會自動在 `data/monitoring.db` 建立SQLite資料庫，包含：
- violations - 違規記錄
- persons - 人員資訊
- cameras - 攝影機設定

## 🚨 故障排除

### 常見問題

**1. RTSP連接失敗**
- 檢查攝影機IP和連接埠
- 確認網路連通性
- 驗證RTSP URL格式

**2. AI檢測不準確**
- 調整信心度閾值
- 確認攝影機畫質
- 檢查光線條件

**3. API通知失敗**
- 測試目標API是否可用
- 檢查網路防火牆設定
- 驗證API端點格式

### 效能優化
- 降低 `processing_fps` (從2改為1)
- 減少同時處理的攝影機數量
- 使用GPU加速 (如果可用)

## 📞 後續支援

### 系統功能
- ✅ 基本監控功能完整
- ✅ 違規檢測和通知
- ✅ 資料儲存和管理
- ⚠️ 人臉識別簡化版

### 擴展功能
如需要以下功能，請考慮進一步開發：
- 精確人臉識別
- 自訂AI模型訓練
- Web管理介面
- 即時影像串流
- 手機APP通知

---

**🎊 系統已準備就緒，可以開始使用！**

**建議下一步：**
1. 設定實際的RTSP攝影機URL
2. 設定通知API端點
3. 執行 `python start_system.py` 開始監控

有任何問題請參考 `README.md` 或 `README_快速開始.md`